name: continuous-dynamic-simulation-testing
on: push

jobs:
  run-simulation:
    runs-on: ubuntu-20.04
    steps:
      - name: checkout simulation data
        uses: actions/checkout@v4
        with: 
          path: 'simdata'
      - name: integrate SSV in SSD
        working-directory: simdata/util/ssv_ssd_integrator
        run: |
          ./install_prerequisites.sh
          node ./ssv_to_ssd_inline.js -i ../../systems/dc_motor_system.ssd -o ../../systems/dc_motor_system.ssd
      - name: install openmcx prerequisites
        run: |
          sudo apt update
          sudo apt install -y cmake git
          sudo apt install -y build-essential
          sudo apt install -y python-is-python3
          sudo apt install -y libxml2-dev zlib1g-dev
      - name: checkout openmcx
        uses: actions/checkout@v4
        with: 
          repository: eclipse/openmcx
          path: 'openmcx'
      - name: build openmcx
        working-directory: openmcx
        run: ./build.sh
      - name: run simulation
        run: ./openmcx/install/openmcx ./simdata/systems/dc_motor_system.ssd --verbose --resultdir ./simdata/metadata/evaluation
      - name: display results
        working-directory: openmcx
        run: cat ./simdata/metadata/evaluation/mechanics_res.csv
            
        
        
          
        
      
  
  
